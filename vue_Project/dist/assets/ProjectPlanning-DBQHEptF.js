import{_ as ae,u as ne,s as oe,c as E,m as ie,e as f,f as ue,a as d,b as l,h as U,n as p,p as w,v as k,F as x,r as y,q as j,t as g,x as de,o as r}from"./index-Dx0rEtDk.js";const re={key:0,class:"p-4 planning-view"},ve={class:"d-flex justify-content-between align-items-center mb-3"},me={class:"d-flex flex-column align-items-end gap-2"},ce={class:"btn-group"},ge={key:0,class:"d-flex align-items-center gap-1 custom-range"},fe={key:1,class:"text-primary"},pe={key:2,class:"text-danger"},De={class:"d-flex align-items-center gap-2"},be={class:"gantt-wrapper shadow-sm"},we={class:"task-table"},ke={class:"phase-row"},xe=["data-bs-toggle","data-bs-target","onClick"],ye={class:"timeline"},he={class:"d"},Te={class:"m"},Me={class:"rows"},Ee={class:"bar-label"},Pe={class:"modal-dialog"},Se={class:"modal-content p-3"},Ce=["value"],Ie={class:"row g-2 mb-2"},Ve={class:"col"},Ue={class:"col"},je={key:1,class:"p-4"},h=864e5,_e={__name:"ProjectPlanning",setup($e){const N=ie(),O=ne(),{projects:q}=oe(O),c=E(()=>q.value.find(t=>t.id===N.params.id)),_=f(null),o=f({phaseIndex:1,title:"",assignee:"",progress:0,startDate:"",endDate:""}),T=f(!1),M=f(null),P=f(null),u=f(null);ue(()=>{const t=_.value;t&&t.addEventListener("hidden.bs.modal",()=>{$()})});function $(){o.value={phaseIndex:1,title:"",assignee:"",progress:0,startDate:"",endDate:""},T.value=!1,M.value=null,P.value=null}function H(){$(),u.value=null,c.value?.phases?.length&&(o.value.phaseIndex=c.value.phases[0].index)}function A(t){u.value=u.value===t?null:t}function W(t,e){u.value&&(u.value==="edit"?(T.value=!0,M.value=t,P.value=e.id,o.value={phaseIndex:t,title:e.title,assignee:e.assignee,progress:e.progress,startDate:e.startDate,endDate:e.endDate}):u.value==="delete"&&confirm("Do you really want to delete this task?")&&(J(t,e.id),u.value=null))}function G(){if(!(!o.value.title||!o.value.startDate||!o.value.endDate)&&c.value){if(T.value&&M.value!=null&&P.value!=null){const t=c.value.phases.find(a=>a.index===M.value);if(!t)return;const e=t.tasks.findIndex(a=>a.id===P.value);if(e===-1)return;const s={...t.tasks[e],...o.value};if(o.value.phaseIndex!==M.value){t.tasks.splice(e,1);const a=c.value.phases.find(n=>n.index===o.value.phaseIndex);a&&a.tasks.push(s)}else t.tasks[e]=s}else{const t=c.value.phases.find(e=>e.index===o.value.phaseIndex);if(!t)return;t.tasks.push({id:Date.now(),...o.value})}u.value=null}}function J(t,e){if(!c.value)return;const s=c.value.phases.find(a=>a.index===t);s&&(s.tasks=s.tasks.filter(a=>a.id!==e))}const v=t=>{const e=new Date(t);return e.setHours(0,0,0,0),e},V=(t,e)=>(v(e).getTime()-v(t).getTime())/h,S=(t,e)=>Math.round(V(t,e))+1,i=f("month"),C=f(""),I=f(""),F=E(()=>{const e=(c.value?.phases.flatMap(n=>n.tasks)||[]).flatMap(n=>[n.startDate,n.endDate]).filter(Boolean).map(n=>v(n).getTime());if(!e.length){const m=v(new Date),b=new Date(m.getTime()+h*6);return{min:m,max:b}}const s=new Date(Math.min(...e)),a=new Date(Math.max(...e));return{min:v(s),max:v(a)}}),D=E(()=>{const t=v(new Date),e=F.value.min,s=F.value.max;let a,n;if(i.value==="week"){const m=t.getDay()||7;a=new Date(t),a.setDate(t.getDate()-(m-1)),n=new Date(a),n.setDate(a.getDate()+6)}else if(i.value==="month")a=new Date(t.getFullYear(),t.getMonth(),1),n=new Date(t.getFullYear(),t.getMonth()+1,0);else if(i.value==="3m"){a=new Date(t.getFullYear(),t.getMonth(),1);const m=new Date(t.getFullYear(),t.getMonth()+3,1);n=new Date(m.getTime()-h)}else if(i.value==="all")a=new Date(e),n=new Date(s);else if(i.value==="custom"&&C.value&&I.value){const m=v(C.value),b=v(I.value);m<=b?(a=m,n=b):(a=b,n=m)}else a=new Date(e),n=new Date(s);return{min:v(a),max:v(n)}}),z=E(()=>{const t=[];let e=new Date(D.value.min);const s=D.value.max,a=S(D.value.min,D.value.max);if(i.value==="week"||i.value==="month")for(;e<=s;)t.push(e.getTime()),e=new Date(e.getTime()+h);else if(i.value==="3m")for(;e<=s;)t.push(e.getTime()),e=new Date(e.getTime()+h*7);else if(i.value==="custom"||i.value==="all")if(a<=31)for(;e<=s;)t.push(e.getTime()),e=new Date(e.getTime()+h);else if(a<=120)for(;e<=s;)t.push(e.getTime()),e=new Date(e.getTime()+h*7);else for(e.setDate(1);e<=s;)t.push(e.getTime()),e.setMonth(e.getMonth()+1),e.setDate(1);else for(e.setDate(1);e<=s;)t.push(e.getTime()),e.setMonth(e.getMonth()+1),e.setDate(1);return t}),B=E(()=>{const t=v(new Date),e=D.value.min,s=D.value.max;if(t<e||t>s)return{visible:!1,style:{}};const a=Math.max(1,S(e,s));return{visible:!0,style:{left:(V(e,t)+.5)/a*100+"%"}}});function K(t){if(!t.startDate||!t.endDate)return{};const e=v(D.value.min),s=v(D.value.max),a=e.getTime(),n=s.getTime(),m=Math.max(1,S(e,s)),b=v(t.startDate),R=v(t.endDate);if(R.getTime()<a||b.getTime()>n)return{display:"none"};const Y=new Date(Math.max(a,b.getTime())),Z=new Date(Math.min(n,R.getTime())),ee=Math.round(V(e,Y)),te=S(Y,Z),se=ee/m*100,le=te/m*100;return{left:se+"%",width:le+"%"}}function Q(t){return t.progress==null?{}:{width:Math.max(0,Math.min(100,t.progress))+"%"}}const L=t=>t?new Date(t).toLocaleDateString("de-DE"):"",X=t=>t.toLocaleString("en-US",{month:"short"});return(t,e)=>c.value?(r(),d("div",re,[l("div",ve,[e[17]||(e[17]=l("div",null,[l("h2",{class:"h5 text-muted"},"Project Planning")],-1)),l("div",me,[l("div",ce,[l("button",{class:p(["btn btn-outline-secondary btn-sm",{active:i.value==="week"}]),onClick:e[0]||(e[0]=s=>{i.value="week",u.value=null})},"Week",2),l("button",{class:p(["btn btn-outline-secondary btn-sm",{active:i.value==="month"}]),onClick:e[1]||(e[1]=s=>{i.value="month",u.value=null})},"Month",2),l("button",{class:p(["btn btn-outline-secondary btn-sm",{active:i.value==="3m"}]),onClick:e[2]||(e[2]=s=>{i.value="3m",u.value=null})},"3 Months",2),l("button",{class:p(["btn btn-outline-secondary btn-sm",{active:i.value==="all"}]),onClick:e[3]||(e[3]=s=>{i.value="all",u.value=null})},"All",2),l("button",{class:p(["btn btn-outline-secondary btn-sm",{active:i.value==="custom"}]),onClick:e[4]||(e[4]=s=>{i.value="custom",u.value=null})},"Custom",2)]),i.value==="custom"?(r(),d("div",ge,[e[15]||(e[15]=l("small",{class:"text-muted me-1"},"from",-1)),w(l("input",{type:"date","onUpdate:modelValue":e[5]||(e[5]=s=>C.value=s),class:"form-control form-control-sm w-auto"},null,512),[[k,C.value]]),e[16]||(e[16]=l("small",{class:"text-muted mx-1"},"to",-1)),w(l("input",{type:"date","onUpdate:modelValue":e[6]||(e[6]=s=>I.value=s),class:"form-control form-control-sm w-auto"},null,512),[[k,I.value]])])):U("",!0),u.value==="edit"?(r(),d("small",fe," Edit mode aktiv – Task anklicken ")):u.value==="delete"?(r(),d("small",pe," Delete mode aktiv – Task anklicken ")):U("",!0)]),l("div",De,[l("button",{class:"btn btn-primary btn-sm","data-bs-toggle":"modal","data-bs-target":"#addTaskModal",onClick:H}," + Add Task "),l("button",{class:p(["btn btn-outline-secondary btn-sm",{"btn-primary text-white":u.value==="edit"}]),onClick:e[7]||(e[7]=s=>A("edit"))}," Edit Task ",2),l("button",{class:p(["btn btn-outline-danger btn-sm",{"btn-danger text-white":u.value==="delete"}]),onClick:e[8]||(e[8]=s=>A("delete"))}," Delete Task ",2)])]),l("div",be,[l("div",we,[e[18]||(e[18]=l("div",{class:"task-header"},[l("div",null,"Task"),l("div",null,"Assigned"),l("div",null,"%"),l("div",null,"Start"),l("div",null,"End")],-1)),(r(!0),d(x,null,y(c.value.phases,s=>(r(),d("div",{key:s.index},[l("div",ke,"Phase "+g(s.index),1),(r(!0),d(x,null,y(s.tasks,a=>(r(),d("div",{key:a.id,class:p(["task-row",{"row-selectable":!!u.value}]),"data-bs-toggle":u.value==="edit"?"modal":null,"data-bs-target":u.value==="edit"?"#addTaskModal":null,onClick:n=>W(s.index,a)},[l("div",null,g(a.title),1),l("div",null,g(a.assignee),1),l("div",null,g(a.progress)+"%",1),l("div",null,g(L(a.startDate)),1),l("div",null,g(L(a.endDate)),1)],10,xe))),128))]))),128))]),l("div",{class:p(["gantt-diagram","zoom-"+i.value])},[B.value.visible?(r(),d("div",{key:0,class:"today-marker",style:j(B.value.style)},null,4)):U("",!0),l("div",ye,[(r(!0),d(x,null,y(z.value,(s,a)=>(r(),d("div",{key:a,class:"tcell"},[l("div",he,g(new Date(s).getDate()),1),l("div",Te,g(X(new Date(s))),1)]))),128))]),l("div",Me,[(r(!0),d(x,null,y(c.value.phases,s=>(r(),d("div",{key:s.index},[e[19]||(e[19]=l("div",{class:"row-spacer"},null,-1)),(r(!0),d(x,null,y(s.tasks,a=>(r(),d("div",{key:a.id,class:"gantt-row"},[(r(!0),d(x,null,y(z.value,(n,m)=>(r(),d("div",{key:m,class:"gcell"}))),128)),l("div",{class:"bar",style:j(K(a))},[l("div",{class:"bar-progress",style:j(Q(a))},null,4),l("span",Ee,g(a.progress!=null?a.progress+"%":""),1)],4)]))),128))]))),128))])],2)]),l("div",{class:"modal fade",id:"addTaskModal",tabindex:"-1",ref_key:"taskModalEl",ref:_},[l("div",Pe,[l("div",Se,[l("h5",null,g(T.value?"Edit Task":"Add Task"),1),e[22]||(e[22]=l("label",null,"Phase",-1)),w(l("select",{"onUpdate:modelValue":e[9]||(e[9]=s=>o.value.phaseIndex=s),class:"form-select mb-2"},[(r(!0),d(x,null,y(c.value.phases,s=>(r(),d("option",{key:s.index,value:s.index}," Phase "+g(s.index),9,Ce))),128))],512),[[de,o.value.phaseIndex,void 0,{number:!0}]]),e[23]||(e[23]=l("label",null,"Title",-1)),w(l("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>o.value.title=s),class:"form-control mb-2"},null,512),[[k,o.value.title]]),e[24]||(e[24]=l("label",null,"Assigned",-1)),w(l("input",{"onUpdate:modelValue":e[11]||(e[11]=s=>o.value.assignee=s),class:"form-control mb-2"},null,512),[[k,o.value.assignee]]),e[25]||(e[25]=l("label",null,"Progress",-1)),w(l("input",{"onUpdate:modelValue":e[12]||(e[12]=s=>o.value.progress=s),type:"number",min:"0",max:"100",class:"form-control mb-2"},null,512),[[k,o.value.progress,void 0,{number:!0}]]),l("div",Ie,[l("div",Ve,[e[20]||(e[20]=l("label",null,"Start",-1)),w(l("input",{"onUpdate:modelValue":e[13]||(e[13]=s=>o.value.startDate=s),type:"date",class:"form-control"},null,512),[[k,o.value.startDate]])]),l("div",Ue,[e[21]||(e[21]=l("label",null,"End",-1)),w(l("input",{"onUpdate:modelValue":e[14]||(e[14]=s=>o.value.endDate=s),type:"date",class:"form-control"},null,512),[[k,o.value.endDate]])])]),l("button",{class:"btn btn-primary w-100","data-bs-dismiss":"modal",onClick:G},g(T.value?"Save":"Add"),1)])])],512)])):(r(),d("div",je,[...e[26]||(e[26]=[l("div",{class:"alert alert-warning"},"Project not found.",-1)])]))}},Fe=ae(_e,[["__scopeId","data-v-4f3582a1"]]);export{Fe as default};
